<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Carnival RNG</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    background: #111;
    color: #fff;
    margin: 0;
    padding: 40px 16px;
    text-align: center;
}

.hidden { display: none; }

/* PLAYER VIEW */
#number {
    font-size: 110px;
    margin: 60px 0;
}

button {
    font-size: 32px;
    padding: 26px 54px;
    border-radius: 14px;
    border: none;
    background: #e63946;
    color: #fff;
}

button:active { transform: scale(0.97); }

/* SETUP VIEW */
.setup button {
    font-size: 22px;
    padding: 18px 36px;
}

input[type="number"], input[type="text"] {
    font-size: 18px;
    width: 220px;
    text-align: center;
    padding: 6px;
}
</style>
</head>

<body>

<!-- DM SETUP SCREEN -->
<div id="setup" class="setup">
    <h1>DM Setup</h1>

    <p>
        Max Roll Value:<br>
        <input type="number" id="maxValue" value="100" min="2">
    </p>

    <br>

    <p>
        <label>
            <input type="radio" name="mode" value="random" checked>
            True Random
        </label>
    </p>

    <p>
        <label>
            <input type="radio" name="mode" value="forced">
            Force Outcomes
        </label>
        <br><br>
        <input type="text" id="forcedList"
               placeholder="e.g. 3,52,99">
    </p>

    <br>
    <button onclick="start()">Start</button>
</div>

<!-- PLAYER SCREEN -->
<div id="play" class="hidden">
    <h1 id="title">Roll</h1>
    <div id="number">—</div>
    <button onclick="roll()">GENERATE</button>
</div>

<script>
let mode = "random";
let forced = [];
let forcedIndex = 0;
let maxRoll = 100;

// START BUTTON
function start() {
    maxRoll = parseInt(document.getElementById("maxValue").value);

    if (!maxRoll || maxRoll < 2) {
        alert("Max roll must be 2 or higher.");
        return;
    }

    mode = document.querySelector('input[name="mode"]:checked').value;

    if (mode === "forced") {
        const raw = document.getElementById("forcedList").value;

        forced = raw
            .split(",")
            .map(n => parseInt(n.trim()))
            .filter(n => n >= 1 && n <= maxRoll);

        if (forced.length === 0) {
            alert("Enter at least one valid forced number within range.");
            return;
        }

        forcedIndex = 0;
    }

    document.getElementById("title").innerText = `Roll 1–${maxRoll}`;
    document.getElementById("setup").classList.add("hidden");
    document.getElementById("play").classList.remove("hidden");
}

// GENERATE ROLL
function roll() {
    const display = document.getElementById("number");
    display.innerText = "…";

    setTimeout(() => {
        let result;

        if (mode === "forced") {
            result = forced[forcedIndex];
            forcedIndex = (forcedIndex + 1) % forced.length;
        } else {
            result = Math.floor(Math.random() * maxRoll) + 1;
        }

        display.innerText = result;
    }, 700);
}

/* SECRET RESET: LONG PRESS TITLE */
let pressTimer;

const title = document.getElementById("title");

title.addEventListener("touchstart", () => {
    pressTimer = setTimeout(reset, 1250);
});

title.addEventListener("touchend", () => {
    clearTimeout(pressTimer);
});

title.addEventListener("touchmove", () => {
    clearTimeout(pressTimer);
});

function reset() {
    document.getElementById("play").classList.add("hidden");
    document.getElementById("setup").classList.remove("hidden");
    document.getElementById("number").innerText = "—";
}
</script>

</body>
</html>
